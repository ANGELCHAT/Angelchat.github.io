---
weight: 34
category: "extending-ui"
subcategory: "extending-chat-widget"
title: "Customer SDK"
tagline: "Build your own Chat Widget."
desc: "If our default widget is not enough, feel free to build your own. Customer JS SDK is your way to go."
versionGroup: "chat-widget"
apiVersion: "2.0"
---

# Introduction

LiveChat Customer SDK is a set of tools utilizing the [LiveChat Customer Chat API](https://developers.livechatinc.com/docs/messaging/customer-chat-api/) that will help you build a custom chat widget. It allows you to communicate with LiveChat services directly from the browser environment using JavaScript, without the need to develop your own backend.

## Is it for me?

If you need to customize the LiveChat widget, using LiveChat Customer SDK is
one of the options to do this. If you need a fully custom solution and you feel
brave, dive into LiveChat Customer SDK: we provide [methods](#methods) and
[events](#events) for deep integration with the LiveChat environment.

Keep in mind, however, that interacting with this API requires **some development skills**. Additionally, it allows you to create front-end apps, so if you are searching for the server-side solutions, you should explore the [LiveChat Customer Chat API](https://developers.livechatinc.com/docs/messaging/customer-chat-api/) instead.

If you want to dive deeper into the LiveChat platform, you might find the [Platform Overview](https://developers.livechatinc.com/docs/getting-started/) article handy.

## About LiveChat Customer SDK

We provide an asynchronous API, where most methods interacting with a server
return **promises**. To get the promise's fulfillment result, subscribe your handler to
the promise's
[`then()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then)
method. You can also subscribe to the emitted events with `on` and `off` methods.

<div class="callout type-info">Not familiar with promises? Read <a href="https://developer.mozilla.org/pl/docs/Web/JavaScript/Reference/Global_Objects/Promise">this article</a> to learn more.</div>

We authenticate your sessions by using
[customer-auth package](https://www.npmjs.com/package/@livechat/customer-auth)
and expose the created `auth` object on the returned SDK's instance. In general,
you don't have to worry about it nor use the exposed object, but if you need to
get the authentication token you can get it through the SDK like this:

```js
customerSDK.auth.getToken().then(token => console.log(token))
```

## Examples

We have prepared a sample chat widget implementation to present the features of LiveChat Customer SDK:

- [Sample widget at CodeSandbox](https://codesandbox.io/s/rm3prxw88n)

## Known issues

Currently, LiveChat Customer SDK does not support queue handling, however, it will be added soon. If you have any questions, you can start a chat with our [24/7 Support](https://direct.lc.chat/1520/125).

# How to start

This tutorial will help you get started with using LiveChat Customer SDK.

## Create an application

First, you need to create an application in the
[Developers Console](https://developers.livechatinc.com/console) (select the _Web app (frontend,
eg. JavaScript)_ type).

## Install Customer SDK

You can use LiveChat Customer SDK in two different ways:

### Using npm

`npm install --save @livechat/customer-sdk`

Now, you can import SDK in your code:

`import * as CustomerSDK from '@livechat/customer-sdk'`

or with a node-style `require` call:

`const CustomerSDK = require('@livechat/customer-sdk')`

### Using script tag - UMD module hosted on unpkg's CDN

`<script src="https://unpkg.com/@livechat/customer-sdk"></script>`

If you just want to look around and play with the SDK, check out our
[sample chat widget implementation](https://codesandbox.io/s/rm3prxw88n).

<div class="callout type-warning">For the time being you need to register your application in the <a href="https://developers.livechatinc.com/console" target="_blank">Developers Console</a>
as a "Web app (frontend, eg. JavaScript)" type. Then, you have to pass the configured <code>redirectUri</code> to the <code>init</code>, along with the regular required properties (<code>license</code> and <code>clientId</code>).</div>

## Use the API

Now run the `init` function with the configuration, replacing `LICENSE_NUMBER`
with your LiveChat license number.

It also accepts some optional arguments:

| shape       | type    | default |
| ----------- | ------- | ------- |
| autoConnect | boolean | true    |
| group       | number  |         |

The function will return the customerSDK instance:

```js
const customerSDK = CustomerSDK.init({
  license: LICENSE_NUMBER,
  clientId: CLIENT_ID,
})
```

With `customerSDK`, you can attach [events](#events):

```js
customerSDK.on('new_event', newEvent => {
  console.log(newEvent)
})
```

or execute [methods](#methods):

```js
const chatId = 'OU0V0P0OWT'
customerSDK
  .sendEvent(chatId, {
    type: 'message',
    text: 'Hi!',
  })
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

### Using the API in React Native

If you want to use LiveChat Customer SDK in React Native, keep in mind that we
use cookies to authenticate your sessions, so we need some sort of browser
environment for that. We've prepared a special wrapper for you to use in React
Native, which opens a WebView component to get an authentication token. All you
have to do is to import it from our authentication package (no need to install
it - the SDK depends on it, so you have it already) and mount it in your React
Native application:

```js
import { AuthWebView } from '@livechat/customer-auth'
import { init } from '@livechat/customer-sdk'

export default class App extends React.Component {
  componentDidMount() {
    const customerSDK = init({
      license: LICENSE_NUMBER,
      clientId: CLIENT_ID,
      redirectUri: REDIRECT_URI,
    })
    // you can start using customerSDK from now
  }

  render() {
    return (
      <View>
        <AuthWebView />
      </View>
    )
  }
}
```

# Key Concepts

The LiveChat system is based on four basic types of entities - users, chats, events and
threads.

- chats consist of threads and threads consist of events
- threads are parts of chats,
- users can add events to chats, which then are automatically added to threads
- users can participate in many chats at the same time

Threads are a vital part of LiveChat architecture. They provide
continuous chat experience (i.e. they never end and you can always add to
them) and they group events in smaller logical chunks, e.g. for reporting and
caching purposes. However, threads tend to complicate handling
various operations like loading more history events. The good part is that you don't
have to worry about them most of the time and this SDK is doing the heavy lifting
behind the scenes for you. You will get notified about threads'
metadata only if you explicitly ask for it - most SDK methods expect only chat
IDs.

You can read more about the Key Concepts of the LiveChat Messaging in the [Messaging Overview](https://developers.livechatinc.com/docs/messaging/#key-concepts).

## User

```js
{
	id: 'ed9d4095-45d6-428d-5093-f8ec7f1f81b9',
	type: 'agent',
	name: 'Jane Doe',
	avatar: 'https://livechat-static.com/assets/images/livechat_logo.ae4271fe1a0a2db838dcf075388ee844.png',
}
```

## Chat

```js
{
	id: 'OU0V0P0OWT',
	users: [{
		id: 'ed9d4095-45d6-428d-5093-f8ec7f1f81b9',
		// ... more user properties
	}],
	lastSeenTimestamps: {
		'ed9d4095-45d6-428d-5093-f8ec7f1f81b9': 1503062591000, // might be null
	},
	threads: ['OU0V0U3IMN'],
}
```

## Event

```js
{
	type: 'message',
	text: 'hi!',
    author: 'ed9d4095-45d6-428d-5093-f8ec7f1f81b9', // assigned by server
	id: 'OU0V0U3IMN_1', // assigned by server
    timestamp: 1503062591000, // assigned by server
    customnId: '814.3316641404942', // optional
    thread: 'OU0V4R0OXP',
	properties: {},
}
```

## Threads

```js
{
	id: 'OU0V0U3IMN',
	active: true,
	order: 3,
	users: ['ed9d4095-45d6-428d-5093-f8ec7f1f81b9'],
	lastSeenTimestamps: {
		'ed9d4095-45d6-428d-5093-f8ec7f1f81b9': 1503062591000, // might be null
	},
	events: [ /* events */ ],
}
```

## Methods

### acceptGreeting

You can use this method to inform that a Customer has seen a greeting. Based on that, the Reports section displays the greetings that were actually seen by Customers, not all the sent greetings. If a Customer started a chat from a greeting, but the Accept Method wasn't executed, the greeting is still counted as seen in Reports.

As arguments to this method you should use `uniqueId` & `greetingId` received in [`incoming_greeting`](./events.md#incoming_greeting) or [`connected`](./events.md#connected) event.

```js
customerSDK
  .acceptGreeting('Q10X0W041P', 7)
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments  | type   |
| ---------- | ------ |
| uniqueId   | string |
| greetingId | number |

#### Errors

- `GREETING_NOT_FOUND` - given `uniqueId` could not be found on the server

### activateChat

Activates an archived chat.

```js
customerSDK
  .activateChat('OU0V0P0OWT', {
    events: [],
  })
  .then(chat => {
    console.log(chat)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments                   | type    | description                                                                                                 |
| --------------------------- | ------- | ----------------------------------------------------------------------------------------------------------- |
| chatId                      | string  |                                                                                                             |
| data.continuous             | boolean | optional                                                                                                    |
| data.chat.access            | Access  | optional                                                                                                    |
| data.chat.properties        | object  | optional                                                                                                    |
| data.chat.thread.events     | Event[] | optional, you can pass initial events here which are going to become part of the created thread immediately |
| data.chat.thread.properties | object  | optional                                                                                                    |

#### Errors

- `CHAT_ALREADY_ACTIVE` - this chat is already active so you can't activate it again.
- `GROUPS_OFFLINE` - a group in which the chat would have been started is offline. Can happen for licenses without continuous chats enabled.

### cancelRate

Cancels rate-related thread properties.

```js
customerSDK
  .cancelRate('ON0X0R0L67', ['score', 'comment'])
  .then(response => {
    console.log(response)
  })
  .catch(() => {
    console.log(error)
  })
```

#### Errors

- `MISSING_CHAT_THREAD` - This means that the chat that was supposed to have its rate canceled is empty and has no threads and because of that this cannot be done.

### closeThread

```js
customerSDK
  .closeThread('ON0X0R0L67')
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments | type   | description                                 |
| --------- | ------ | ------------------------------------------- |
| chat      | string | Chat's id in which thread should get closed |

Returned value:

| shape   | type    |
| ------- | ------- |
| success | boolean |

### connect

Starts connecting to our servers. This is needed when:

- `autoConnect: false` has been passed to the `init` method,
- or when you get disconnected with a reason suspending reconnection attempts (such as `inactivity_timeout`)

### deleteChatProperties

Deletes given properties from a chat.

```js
customerSDK
  .deleteChatProperties('ON0X0R0L67', {
    property_namespace: ['sample'],
  })
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments  | type   | description                                     |
| ---------- | ------ | ----------------------------------------------- |
| chat       | string | id of the chat you want to delete properties of |
| properties | object | chat properties to delete                       |

Returned value:

| shape   | type    |
| ------- | ------- |
| success | boolean |

### deleteChatThreadProperties

Deletes given properties from a chat thread.

```js
customerSDK
  .deleteChatThreadProperties('ON0X0R0L67', 'OS0C0W0Z1B', {
    property_namespace: ['sample'],
  })
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments  | type   | description                                       |
| ---------- | ------ | ------------------------------------------------- |
| chat       | string | id of the chat you want to delete properties of   |
| thread     | string | id of the thread you want to delete properties of |
| properties | object | properties to be deleted                          |

Returned value:

| shape   | type    |
| ------- | ------- |
| success | boolean |

### deleteEventProperties

Deletes given properties from an event.

```js
customerSDK
  .deleteEventProperties('ON0X0R0L67', 'OS0C0W0Z1B', 'Q50W0A0P0Y', {
    property_namespace: ['sample'],
  })
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments  | type   | description                                       |
| ---------- | ------ | ------------------------------------------------- |
| chat       | string | id of the chat you want to delete properties of   |
| thread     | string | id of the thread you want to delete properties of |
| event      | string | id of the event you want to delete properties of  |
| properties | object | properties to be deleted                          |

Returned value:

| shape   | type    |
| ------- | ------- |
| success | boolean |

### destroy

This method clears any held resources, removes all listeners and disconnects from the network.
After using this method you won't be able to use the destroyed SDK's instance.

```js
customerSDK.destroy()
```

### disconnect

```js
customerSDK.disconnect()
```

### getChatHistory

This method facilitates loading more historical threads' events.
You need to get access to the `history` object for a certain chat by calling this method.
The returned `history` object has only one method, `next`, which gives you a `Promise` with a `{ done, value }` object.

- `done` - indicates if there is anything more to load
- `value` - an array of threads, each containing an array of its events

You can keep calling `history.next()` multiple times to load previous history events, which are going to be grouped into threads and might require merging with already loaded events.
This is useful for implementing an infinite scroll or otherwise showing archival chat's to your customer.
Keep in mind, though, that you generally shouldn't call `next` while the history is being loaded - we queue those requests so the previous one must resolve before we proceed with the next one.

Such a structure like our `history` object is called an **async iterator**.

```js
let wholeChatHistoryLoaded = false

const history = customerSDK.getChatHistory('OU0V0P0OWT')

history.next().then(result => {
  if (result.done) {
    wholeChatHistoryLoaded = true
  }

  const threads = result.value
  const events = threads
    .map(thread => thread.events || [])
    .reduce((acc, current) => acc.concat(current), [])

  console.log(events)
})
```

Arguments:

| arguments | type   | description                                           |
| --------- | ------ | ----------------------------------------------------- |
| chat      | string | Chat's id for which history object should be returned |

### getChatsSummary

```js
customerSDK
  .getChatsSummary({
    offset: 0,
    limit: 10,
  })
  .then(({ chatsSummary, totalChats }) => {
    console.log(chatsSummary)
    console.log(totalChats)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments  | shape  | type   | default | max | description |
| ---------- | ------ | ------ | ------- | --- | ----------- |
| pagination |        |        |         |     |             |
|            | offset | number | 0       |     |             |
|            | limit  | number | 10      | 25  |             |

Returned value:

| shape        | type     | shape              | type     | description                                        |
| ------------ | -------- | ------------------ | -------- | -------------------------------------------------- |
| chatsSummary | object[] |                    |          |                                                    |
|              |          | id                 |          | Chat's id                                          |
|              |          | active             | boolean  |                                                    |
|              |          | users              | string[] | Users' ids                                         |
|              |          | lastEvent          | object   | Event                                              |
|              |          | lastEventsPerType  | object   | Map from event types to event objects              |
|              |          | lastSeenTimestamps | object   | Map from Users' ids to optional lastSeenTimestamps |
|              |          | lastThread         | string   | Thread's id                                        |
| totalChats   | number   |                    |          |                                                    |

### getChatThreads

In most cases you do not need to use this method directly. If you want to load
more events, consider using [`getChatHistory`](#getchathistory).

```js
const threads = ["OS0C0W0Z1B", "OS0I0M0J0G", "OT01080705", "OT0E02082U", "OT0E08040G"]
customerSDK.getChatThreads("ON0X0R0L67", threads)
    .then(threads => {
        console.log(threads)
    })
    .catch(error => {
        console.log(rror
    })
```

Arguments:

| arguments | shape | type     |
| --------- | ----- | -------- |
| chat      |       | string   |
| threads   | page  | string[] |

Returned value:

| array of shapes | type     | description                     |
| --------------- | -------- | ------------------------------- |
| id              | string   | Thread's id                     |
| chat            | string   | Chat's id                       |
| active          | string[] | Active state                    |
| order           | number   | order (can be used for sorting) |
| users           | string[] | Users' ids                      |
| events          | object[] | Events                          |

### getChatThreadsSummary

Returns a summary of your chat threads, including the total count of threads, a list of id's and number of events in each thread.
In most cases you will not need to use this method directly, instead consider using [`getChatHistory`](#getchathistory).

```js
customerSDK
  .getChatThreadsSummary('ON0X0R0L67', {
    offset: 0,
    limit: 10,
  })
  .then(summary => {
    console.log(summary.threadsSummary)
    console.log(summary.totalThreads)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments  | shape  | type   | default | max  | description |
| ---------- | ------ | ------ | ------- | ---- | ----------- |
| chat       |        | string |         |      |             |
| pagination |        |        |         |      |             |
|            | offset | number | 0       |      |             |
|            | limit  | number | 25      | 1000 |             |

Returned value:

| shape          | type     | shape       | type   |
| -------------- | -------- | ----------- | ------ |
| threadsSummary | object[] |             |        |
|                |          | id          | string |
|                |          | order       | number |
|                |          | totalEvents | number |
| totalThreads   | number   |             |        |

### getCustomer

Returns the info about the Customer requesting it.

```js
customerSDK
  .getCustomer()
  .then(customer => {
    console.log(customer)
  })
  .catch(error => {
    console.log(error)
  })
```

Returned value:

| shape  | type       | description          |
| ------ | ---------- | -------------------- |
| type   | 'customer' |                      |
| id     | string     |                      |
| name   | string     | returned only if set |
| email  | string     | returned only if set |
| avatar | string     | returned only if set |
| fields | object     | returned only if set |

### getForm

This method allows to fetch a form template for a given group and form type.

```js
customerSDK
  .getForm(0, 'prechat')
  .then(response => {
    if (response.enabled) {
      // prechat form is enabled for this group in the configurator
      console.log(response.form)
    }
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments | type                              |
| --------- | --------------------------------- |
| group     | number                            |
| type      | 'prechat', 'postchat' or 'ticket' |

Returned value:

| shape       | type     | description                                 |
| ----------- | -------- | ------------------------------------------- |
| enabled     | boolean  |                                             |
| form        | object   | available only when a given form is enabled |
| form.id     | string   |                                             |
| form.fields | object[] |                                             |

### getGroupsStatus

Returns availability statuses of the requested groups.

```js
customerSDK
  .getGroupsStatus([3, 10])
  .then(statusMap => {
    console.log(`Status of the group 3: ${statusMap[3]}`)
    console.log(`Status of the group 10: ${statusMap[10]}`)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments | type     |                                                          |
| --------- | -------- | -------------------------------------------------------- |
| groups    | number[] | optional, if omitted statuses of all groups are returned |

Returned value:

| shape     | type   | description                                     |
| --------- | ------ | ----------------------------------------------- |
| statusMap | object | a map of group numbers to availability statuses |

### getPredictedAgent

```js
customerSDK
  .getPredictedAgent(0)
  .then(agent => {
    console.log(agent)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments | type   | description |
| --------- | ------ | ----------- |
| group     | number | optional    |

#### Errors

- `GROUP_OFFLINE` - the requested group is offline and predicted agent can't be returned for it.
- `GROUP_UNAVAILABLE` - there are no available slots in the requested group, so a predicted agent can't be returned for it, but if you call `startChat` or `activateChat` appropriately you are most likely to end up in the queue.

### getUrlDetails

It returns the info on a given URL.

```js
customerSDK
  .getUrlDetails('https://www.livechatinc.com')
  .then(urlDetails => {
    if (urlDetails.title) {
      console.log(`The title of requested URL is: ${urlDetails.title}`)
    }
    if (urlDetails.description) {
      console.log(
        `The description of requested URL is: ${urlDetails.description}`,
      )
    }
    if (urlDetails.image) {
      console.log(
        `The preview image of requested URL is available under: ${urlDetails.image.url}`,
      )
      console.log(`Its width is: ${urlDetails.image.width}`)
      console.log(`Its height is: ${urlDetails.image.height}`)
    }
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments | type   |
| --------- | ------ |
| url       | string |

Returned value:

| shape        | type   | description                         |
| ------------ | ------ | ----------------------------------- |
| url          | string |                                     |
| title        | string | optional                            |
| description  | string | optional                            |
| image.url    | string | available only if image is returned |
| image.width  | number | available only if image is returned |
| image.height | number | available only if image is returned |

### off

This method unsubscribes from emitted events which are described [here](#events).

### on

This method subscribes to emitted events which are described [here](#events).

### once

This method subscribes to emitted events which are described [here](#events) and unsubscribes immediately after the callback gets called.

### markEventsAsSeen

Marks events as seen by the current customer up to the given date.

```js
customerSDK
  .markEventsAsSeen('ON0X0R0L67', '2017-10-12T15:19:21.010200Z')
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments | type   | description                                                                          |
| --------- | ------ | ------------------------------------------------------------------------------------ |
| chat      | string | id of the chat in which you want to mark events as seen                              |
| seenUpTo  | string | RFC 3339 date-time format, you should use event's `createdAt` value as this argument |

Returned value:

| shape   | type    |
| ------- | ------- |
| success | boolean |

### rateChat

Sends a chat rating and comment for the most recent chat thread.

```js
customerSDK
  .rateChat('ON0X0R0L67', {
    score: 1,
    comment: 'Agent helped me a lot!',
  })
  .then(() => {
    console.log('Rating has been set')
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments      | type   | description                                               |
| -------------- | ------ | --------------------------------------------------------- |
| chat           |        | Destination chat's id                                     |
| rating         |        |                                                           |
| rating.score   | 0 or 1 | Rating value - 0 for a bad rating and 1 for a good rating |
| rating.comment | string | Optional comment                                          |

Returned value:

| type    | description                                     |
| ------- | ----------------------------------------------- |
| Promise | Promise resolving with a constant success value |

#### Errors

- `MISSING_CHAT_THREAD` - the chat that was supposed to be rated is empty and has no threads and because of that it cannot be rated.

### rejectGreeting

Rejects a greeting (an invitation to the chat). For example, Customers could reject greetings by clicking close icon on the displayed greeting.

```js
customerSDK
  .rejectGreeting('Q10X0W041P')
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments | type   | description |
| --------- | ------ | ----------- |
| uniqueId  | string |             |

#### Errors

- `GREETING_NOT_FOUND` - given `uniqueId` could not be found on the server

### sendEvent

```js
const event = {
  type: 'message',
  // ... other properties specific for the event's type
}

customerSDK
  .sendEvent('ON0X0R0L67', event)
  .then(event => {
    console.log(event)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments               | type    | description           |
| ----------------------- | ------- | --------------------- |
| chat                    | string  | Destination chat's id |
| event                   |         |                       |
| event.type              | string  | Type of the event     |
| meta                    |         | optional              |
| meta.attachToLastThread | boolean | optional              |

### sendPostback

```js
customerSDK
  .sendPostback('ON0X0R0L67', 'OS0C0W0Z1B', 'OS0C0W0Z1B01', {
    id: 'OS0C0W0Z1B01002',
    toggled: true,
  })
  .then(rating => {
    console.log('success')
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments        | type    | description                     |
| ---------------- | ------- | ------------------------------- |
| chat             | string  | Postback chat's id              |
| thread           | string  | Postback thread's id            |
| event            | string  | Postback event's id             |
| postback         |         |                                 |
| postback.id      | string  | Postback button's id            |
| postback.toggled | boolean | Postback toggled (default true) |

### sendTicketForm

Can be used to send a filled ticket form.

```js
customerSDK
  .sendTicketForm(
    {
      type: 'filled_form',
      formId: '',
      fields: [
        {
          type: 'subject',
          id: '0',
          label: 'Subject:',
          answer: 'Order number 123',
        },
        {
          type: 'email',
          id: '1',
          label: 'Your email:',
          answer: 'john.doe@example.com',
        },
        {
          type: 'checkbox',
          id: '2',
          label: 'Question:',
          answers: [
            { id: '0', label: 'First answer' },
            { id: '1', label: 'Second answer' },
          ],
        },
        {
          type: 'textarea',
          id: '3',
          label: 'Your message:',
          answer:
            'Could I get a status update on this order? Have you already shipped it?',
        },
      ],
    },
    10,
  )
  .then(response => {
    console.log(`Created a ticket with ID: ${response.id}`)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments         | type              | description |
| ----------------- | ----------------- | ----------- |
| filledForm.type   | 'filled_form'     |             |
| filledForm.formId | string            |             |
| filledForm.fields | FilledFormField[] |             |
| group             | number            | optional    |

Returned value:

| shape | type   | description              |
| ----- | ------ | ------------------------ |
| id    | string | id of the created ticket |

### setCustomerFields

This method doesn't return a promise.
It sends the request if the SDK is connected or queues the update to be performed once the connection gets established.

```js
customerSDK.setCustomerFields({
  foo: 'bar',
  test: 'qwerty',
})
```

Arguments:

| arguments | type   | description |
| --------- | ------ | ----------- |
| fields    | object |             |

### setSneakPeek

This method doesn't return a promise.
It can be used to update the [sneak peek](https://www.livechatinc.com/blog/customer-message-sneak-peak/) in the agent application.
It will be sent to the server only if the target chat is active and only once per 2 seconds (it's [throttled](https://lodash.com/docs/4.17.4#throttle)).

```js
customerSDK.setSneakPeek('ON0X0R0L67', 'what is the price for your ')
```

Arguments:

| arguments | type   | description                              |
| --------- | ------ | ---------------------------------------- |
| chat      | string | Destination chat id                      |
| text      | string | Message preview broadcasted to the agent |

### startChat

```js
customerSDK
  .startChat({
    events: [],
  })
  .then(chat => {
    console.log(chat)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments            | type     | description        |
| -------------------- | -------- | ------------------ |
| specification        |          | For advanced usage |
| specification.scope  |          |                    |
| specification.events | events[] |                    |

#### Errors

- `CHAT_LIMIT_REACHED` - the maximum limit of chats per customer has been reached and it's not possible to start a new one. You should activate one of the existing ones. By default the limit is 1.
- `GROUPS_OFFLINE` - a group in which the chat would have been started is offline. Can happen for licenses that don't allow customers to chat during their unavailability.

### updateChatProperties

```js
const properties = {
  property_namespace: {
    sample: 'property',
  },
}
customerSDK
  .updateChatProperties('ON0X0R0L67', properties)
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments  | type   | description                                     |
| ---------- | ------ | ----------------------------------------------- |
| chat       | string | id of the chat you want to update properties of |
| properties | object |

### updateChatThreadProperties

```js
const properties = {
  property_namespace: {
    sample: 'property',
  },
}
customerSDK
  .updateChatThreadProperties('ON0X0R0L67', 'OS0C0W0Z1B', properties)
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments  | type   | description                                       |
| ---------- | ------ | ------------------------------------------------- |
| chat       | string | id of the chat you want to update properties of   |
| thread     | string | id of the thread you want to update properties of |
| properties | object |

### updateCustomer

```js
const properties = {
  name: 'John Doe',
  email: 'john.doe@example.com',
  fields: {
    custom_property: 'BasketValue=10usd',
    any_key_is_ok: 'sample custom field',
  },
}
customerSDK.updateCustomer(properties)
```

Arguments:

| arguments         | type   | description                               |
| ----------------- | ------ | ----------------------------------------- |
| properties        |        |                                           |
| properties.name   | string | Optional name                             |
| properties.email  | string | Optional email                            |
| properties.fields | object | Optional custom fields with string values |

### updateCustomerPage

```js
customerSDK.updateCustomerPage({
  url: 'https://developers.livechatinc.com/',
  title: 'LiveChat for Developers',
})
```

Arguments:

| arguments  | type   | description |
| ---------- | ------ | ----------- |
| page       |        |             |
| page.url   | string |             |
| page.title | string |             |

### updateEventProperties

Updates given properties on an event.

```js
const properties = {
  property_namespace: {
    sample: 'property',
  },
}
customerSDK
  .updateEventProperties('ON0X0R0L67', 'OS0C0W0Z1B', 'Q50W0A0P0Y', properties)
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments  | type   | description                                       |
| ---------- | ------ | ------------------------------------------------- |
| chat       | string | id of the chat you want to update properties of   |
| thread     | string | id of the thread you want to update properties of |
| event      | string | id of the event you want to update properties of  |
| properties | object |                                                   |

### uploadFile

This method returns both a `promise` and a `cancel`. You can use `cancel` to abort the upload of the file.
It also lets you pass `onProgress` callback function. Keep in mind that the maximum accepted file size is 10 MB.

```js
const { promise, cancel } = customerSDK.uploadFile(
  'ON0X0R0L67',
  {
    file,
    customId, // optional
  },
  {
    onProgress: progress => console.log(`upload progress: ${progress}`),
  },
)

document.getElementById('cancel-upload').onclick = () => {
  cancel()
}

promise
  .then(response => {
    console.log(response.url)
  })
  .catch(error => {
    console.log(error)
  })
```

Arguments:

| arguments       | type     | description                                                                   |
| --------------- | -------- | ----------------------------------------------------------------------------- |
| chat            | string   | Destination chat's id                                                         |
| data            |          |                                                                               |
| data.file       | Blob     |                                                                               |
| data.customId   | string   | Optional customId for the event                                               |
| spec            |          |                                                                               |
| spec.onProgress | function | This callback function will receive a progress value - number between 0 and 1 |

Returned value:

| shape | type   |
| ----- | ------ |
| url   | string |

In React Native instead of passing a blob you need to pass an object of
[such shape](https://github.com/facebook/react-native/blob/56fef9b6225ffc1ba87f784660eebe842866c57d/Libraries/Network/FormData.js#L34-L38):

```js
const file = {
  uri: uriFromCameraRoll,
  type: 'image/jpeg', // optional
  name: 'photo.jpg', // optional
}
```

## Events

You can listen for emitted events by subscribing to them (using the [on method](#on)) with your custom JavaScript function.
For example, your function can be executed every time a message has been received.

### access_set

Informs that new, single access to a resource was set. The existing access is overwritten.

```js
customerSDK.on('access_set', ({ resource, id, access }) => {
  console.log(resource)
  console.log(id)
  console.log(access)
})
```

Payload:

| shape    | type   | description |
| -------- | ------ | ----------- |
| resource | string |             |
| id       | string |             |
| access   | object |             |

### availability_updated

```js
customerSDK.on('availability_updated', ({ availability }) => {
  console.log(availability)
})
```

Payload:

| shape        | type   | description           |
| ------------ | ------ | --------------------- |
| availability | string | 'online' or 'offline' |

### chat_properties_deleted

Informs about those chat properties that were deleted.

```js
customerSDK.on('chat_properties_deleted', ({ chat, properties }) => {
  console.log(chat)
  console.log(properties)
})
```

Payload:

| shape      | type   | description     |
| ---------- | ------ | --------------- |
| chat       | string | Chat's id       |
| properties | object | Chat properties |

### chat_properties_updated

```js
customerSDK.on('chat_properties_updated', payload => {
  console.log(payload.chat)
  console.log(payload.properties)
})
```

Payload:

| shape      | type   | description     |
| ---------- | ------ | --------------- |
| chat       | string | Chat's id       |
| properties | object | Chat properties |

### chat_thread_properties_deleted

Informs about those chat thread properties that were deleted.

```js
customerSDK.on(
  'chat_thread_properties_deleted',
  ({ chat, thread, properties }) => {
    console.log(chat)
    console.log(thread)
    console.log(properties)
  },
)
```

Payload:

| shape      | type   | description            |
| ---------- | ------ | ---------------------- |
| chat       | string | Chat's id              |
| thread     | string | Thread's id            |
| properties | object | Chat thread properties |

### chat_thread_properties_updated

```js
customerSDK.on('chat_thread_properties_updated', payload => {
  console.log(payload.chat)
  console.log(payload.thread)
  console.log(payload.properties)
})
```

Payload:

| shape      | type   | description       |
| ---------- | ------ | ----------------- |
| chat       | string | Chat's id         |
| thread     | string | Thread's id       |
| properties | object | Thread properties |

### chat_transferred

Informs that a chat was transferred to a different group or to an agent.

```js
customerSDK.on('chat_transferred', payload => {
  // TODO: trying to understand how this works
})
```

Payload:

| shape       | type               | description |
| ----------- | ------------------ | ----------- |
| chatId      | string             |             |
| threadId    | string             |             |
| requesterId | string             |             |
| type        | 'agent' \| 'group' |             |
| ids         | string[]           |             |

### chat_user_added

Informs that a user was added to a chat.

```js
customerSDK.on('chat_user_added', ({ user, chat, present }) => {
  console.log({ user, chat, present })
})
```

Payload:

| shape   | type    | description |
| ------- | ------- | ----------- |
| user    | object  | User        |
| chat    | string  | Chat's ID   |
| present | boolean |             |

### chat_user_removed

Informs that a user was removed from a chat.

```js
customerSDK.on('chat_user_removed', ({ userId, chat }) => {
  console.log({ userId, chat })
})
```

Payload:

| shape  | type   | description |
| ------ | ------ | ----------- |
| userId | string | User's ID   |
| chat   | string | Chat's ID   |

### connected

```js
customerSDK.on('connected', payload => {
  console.log('connected')
})
```

Payload:

| argument     | type     | description                                        |
| ------------ | -------- | -------------------------------------------------- |
| availability | string   | 'online' or 'offline'                              |
| greeting?    | Greeting | optional greeting received before the chat started |

Greeting:

| argument           | type    | description                          |
| ------------------ | ------- | ------------------------------------ |
| id                 | number  | greeting template identifier         |
| text               | string  | text content of the greeting message |
| uniqueId           | string  | event uniqueId for the greeting      |
| displayedFirstTime | boolean |                                      |
| accepted           | boolean |                                      |
| agent.id           | string  |                                      |
| agent.name         | string  |                                      |
| agent.avatar       | string  |                                      |
| agent.jobTitle     | string  |                                      |
| agent.isBot        | boolean |                                      |

### connection_lost

```js
customerSDK.on('connection_lost', () => {
  console.log('connection_lost')
})
```

This event doesn't carry any additional payload.

### connection_recovered

It informs that Customer SDK has recovered from "unstable" connection state. It's always preceeded by [`"connection_unstable"`](#connection_unstable) event.

```js
customerSDK.on('connection_recovered', () => {
  console.log('connection_recovered')
})
```

This event doesn't carry any additional payload.

### connection_unstable

It informs that Customer SDK has detected that connection quality is poor. It doesn't mean that it has disconnected from the server just yet.

```js
customerSDK.on('connection_unstable', () => {
  console.log('connection_unstable')
})
```

This event doesn't carry any additional payload.

### customer_id

```js
customerSDK.on('customer_id', id => {
  console.log('customer id is', id)
})
```

Payload:

| argument | type   |
| -------- | ------ |
| id       | string |

### customer_page_updated

Informs that a Customer changed the website - moved to another page of the website, for example by clicking on a link.

```js
customerSDK.on('customer_page_updated', ({ url, title, timestamp }) => {
  console.log(url)
  console.log(title)
  console.log(timestamp)
})
```

Payload:

| shape     | type   |                                                      |
| --------- | ------ | ---------------------------------------------------- |
| url       | string | URL on which the Customer currently is.              |
| title     | string | Title of the website on which Customer currently is. |
| timestamp | string | Timestamp of the latest change.                      |

### customer_updated

Informs that Customer's data was updated.

```js
customerSDK.on('customer_updated', payload => {
  if (payload.name) {
    console.log(`Name got updated to: ${payload.name}`)
  }
  if (payload.email) {
    console.log(`Email got updated to: ${payload.email}`)
  }
  if (payload.avatar) {
    console.log(`Avatar got updated to: ${payload.avatar}`)
  }
  if (payload.fields) {
    console.log(`Fields got updated:`)
    console.log(payload.fields)
  }
})
```

Payload:

| shape  | type   |                                                            |
| ------ | ------ | ---------------------------------------------------------- |
| name   | string | Updated name of the customer, available only if updated.   |
| email  | string | Updated email of the customer, available only if updated.  |
| avatar | string | Updated avatar of the customer, available only if updated. |
| fields | string | Updated fields of the customer, available only if updated. |

### disconnected

```js
customerSDK.on('disconnected', ({ reason }) => {
  console.log(reason)
})
```

Payload:

| shape  | type   | description                                           |
| ------ | ------ | ----------------------------------------------------- |
| reason | string | [./errors.md#disconnection-reasons](Possible reasons) |

### event_properties_deleted

Informs about those event properties that were deleted.

```js
customerSDK.on(
  'event_properties_deleted',
  ({ chat, thread, event, properties }) => {
    console.log(chat)
    console.log(thread)
    console.log(event)
    console.log(properties)
  },
)
```

Payload:

| shape      | type   | description      |
| ---------- | ------ | ---------------- |
| chat       | string | Chat's id        |
| thread     | string | Thread's id      |
| event      | string | Event's id       |
| properties | object | Event properties |

### event_properties_updated

Informs about those event properties that were updated.

```js
customerSDK.on(
  'event_properties_updated',
  ({ chat, thread, event, properties }) => {
    console.log(chat)
    console.log(thread)
    console.log(event)
    console.log(properties)
  },
)
```

Payload:

| shape      | type   | description      |
| ---------- | ------ | ---------------- |
| chat       | string | Chat's id        |
| thread     | string | Thread's id      |
| event      | string | Event's id       |
| properties | object | Event properties |

### event_updated

Informs that an event was updated.

```js
customerSDK.on('event_updated', ({ chat, thread, event }) => {
  console.log(chat)
  console.log(thread)
  console.log(event)
})
```

Payload:

| shape  | type   | description         |
| ------ | ------ | ------------------- |
| chat   | string | Chat's id           |
| thread | string | Thread's id         |
| event  | object | Whole updated event |

### events_marked_as_seen

```js
customerSDK.on('events_marked_as_seen', payload => {
  console.log(payload.chat)
  console.log(payload.user)
  console.log(payload.timestamp)
})
```

Payload:

| shape     | type   | description |
| --------- | ------ | ----------- |
| chat      | string | Chat's id   |
| user      | string | User's id   |
| timestamp | number |             |

### incoming_chat_thread

Informs about a new thread coming in the chat. The push payload contains not only the new thread, but the whole chat data structure. If the chat was started with some initial events, the thread object contains them.

```js
customerSDK.on('incoming_chat_thread', payload => {
  console.log(payload.chat)
})
```

Payload:

| shape           | type     | description                          |
| --------------- | -------- | ------------------------------------ |
| chat.id         | string   | Chat's id                            |
| chat.access     | object   | Chat's initial access                |
| chat.users      | object[] | Users objects referenced in the chat |
| chat.properties | object   | Chat properties                      |
| chat.thread     | object   | Thread                               |

### incoming_event

Informs about an incoming event sent to a chat.
You should distinguish received events by their types.

```js
customerSDK.on('incoming_event', ({ chat, event }) => {
  switch (event.type) {
    case 'message':
      console.log('new message - ', event.text)
      break
    default:
      break
  }
})
```

Payload:

| shape | type   | description      |
| ----- | ------ | ---------------- |
| type  | string | Event's type     |
| ...   |        | Other properties |

### incoming_greeting

Informs about an incoming greeting.

```js
customerSDK.on('incoming_greeting', payload => {
  console.log(
    `Received a greeting with "${payload.text}" text content from ${payload.agent.name} agent.`,
  )
})
```

Payload:

| shape              | type    | description                                                         |
| ------------------ | ------- | ------------------------------------------------------------------- |
| id                 | number  | Greeting's id                                                       |
| text               | string  | Greeting's text content                                             |
| uniqueId           | string  | Greeting's unique ID                                                |
| displayedFirstTime | boolean | Boolean indicator if the greeting was generated for the first time. |
| accepted           | boolean | Chat properties                                                     |
| agent              | object  | User                                                                |

### incoming_rich_message_postback

Informs about an incoming greeting.

```js
customerSDK.on('incoming_rich_message_postback', payload => {
  console.log(payload.user)
  console.log(payload.chat)
  console.log(payload.thread)
  console.log(payload.event)
  console.log(payload.postback)
})
```

Payload:

| shape            | type    | description                                          |
| ---------------- | ------- | ---------------------------------------------------- |
| user             | number  | User who has sent a rich message postback            |
| chat             | string  | id of the chat in which the postback has been sent   |
| thread           | string  | id of the thread in which the postback has been sent |
| event            | boolean | id of the event for which the postback has been sent |
| postback.id      | boolean | id of the sent postback                              |
| postback.toggled | boolean | boolean indicating if the postback has been toggled  |

### incoming_typing_indicator

Informs that one of the chat users is currently typing a message.
The message hasn't been sent yet.
The push payload contains the typing indicator object.

```js
customerSDK.on('incoming_typing_indicator', payload => {
  if (payload.isTyping) {
    console.log(
      `user with ${payload.user} id is writing something in ${payload.chat}`,
    )
  } else {
    console.log(
      `user with ${payload.user} id stopped writing in ${payload.chat}`,
    )
  }
})
```

Payload:

| shape    | type    | description |
| -------- | ------- | ----------- |
| chat     | string  | Chat's id   |
| user     | string  | User's id   |
| isTyping | boolean |             |

### thread_closed

```js
customerSDK.on('thread_closed', ({ chat }) => {
  console.log(chat)
})
```

Payload:

| shape | type   | description |
| ----- | ------ | ----------- |
| chat  | string | Chat's id   |

### user_data

```js
customerSDK.on('user_data', user => {
  console.log(user)
})
```

Customer user:

| shape  | type           | description |
| ------ | -------------- | ----------- |
| type   | 'customer'     |             |
| id     | string         |             |
| name   | string         | optional    |
| email  | string         | optional    |
| avatar | string         | optional    |
| fields | CustomerFields |             |

Agent user:

| shape    | type    | description |
| -------- | ------- | ----------- |
| type     | 'agent' |             |
| id       | string  |             |
| name     | string  |             |
| avatar   | string  |             |
| jobTitle | string  |             |

## Disconnection reasons and errors

### Disconnection reasons

Most of the disconnection reasons can be treated as errors, that's why they are described in more details in this section.

```js
customerSDK.on('disconnected', ({ reason }) => {
  switch (reason) {
    case 'access_token_expired':
      // handle particular disconnection reasons
      break
    // ...
    default:
  }
})
```

#### access_token_expired

Access token lifetime has elapsed. Customer SDK will fetch a new token and reconnect to the server on its own. This is emitted to the user for informational purposes, so, for example, a reconnection bar can be displayed.

#### customer_banned

Customer has been banned.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

#### customer_temporarily_blocked

Customer tried reconnecting too many times after the `"too_many_connections"` error had occurred.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

#### identity_mismatch

The identity of the customer has changed between reconnects. This might happen if cookies can't be persisted in the browser.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

#### inactivity_timeout

Customer didn't chat or change the page in the past 30 minutes. Customer SDK **won't** try to reconnect on its own after receiving this. You should implement a reconnect login on your own, preferably you should only try to connect again when you detect a clear intention of chatting from your user.

#### internal_error

Internal error. Customer SDK will try to reconnect on its own.

#### license_not_found

The license with the specified ID doesn't exist. You should check the options passed to the Customer SDK and make sure that the license parameter is correct.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

#### misdirected_connection

You have connected to a server in the wrong region. Customer SDK will reconnect to the correct region on its own, but to avoid this problem altogether you should provide correct `region` parameter when initializing the SDK. This is emitted to the user for informational purposes, so, for example, a reconnection bar can be displayed.

#### too_many_connections

Customer has reached the maximum number of connections. This normally shouldn't happen if you don't open too many concurrent connections being the same customer.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

#### too_many_unauthorized_connections

The maximum number of unauthorized connections has been reached. This error can only be received immediately after you try to connect to our servers when there are too many pending (unauthorized) connections. Once you get authorized, you stay that way and Customer SDK will try to reconnect on its own.

#### unsupported_version

Connecting to an unsupported version of the Customer Chat API. You should upgrade your Customer SDK version.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

#### users_limit_reached

The maximum number of concurrently connected customers has been reached. This can only be received immediately after we try to connect to our servers because once you get authorized, you stay that way. The limit is different for each plan and you can check what it is on our [pricing page](https://www.livechatinc.com/pricing/).

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

### Errors

This is the list of common error codes, you can receive them for all available methods which perform API calls. This means that those can happen for methods returning promises and because we wrap API calls with promise interface, those are available on thrown Error objects under the `code` property and can be caught using regular promise `catch` method.

There are also some per-method error codes which are not described below, but rather they are mentioned under particular methods which can fail with them.

#### CONNECTION_LOST

All in-flight requests fail with this one when when the network connection gets lost.

#### CUSTOMER_BANNED

Customer has been banned.

#### GROUP_NOT_FOUND

Can be received in response to any request which accepts a group somewhere in its payload.

#### INTERNAL

Internal error.

#### PENDING_REQUESTS_LIMIT_REACHED

This is rate-limiting error, you have sent out too many requests in a quick succession which had not yet a chance to resolve.

#### REQUEST_TIMEOUT

The request has timed out.

#### VALIDATION

Wrong format of request, for example a string sent in the place of a number.

# Changelog

#### [v2.0.0-alpha.0] - 2018-08-17

Initial alpha release.
