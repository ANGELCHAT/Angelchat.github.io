---
weight: 34
category: "extending-ui"
subcategory: "extending-chat-widget"
title: "Customer SDK"
tagline: "Build your own Chat Widget."
desc: "If our default widget is not enough, feel free to build your own. Customer JS SDK is your way to go."
versionGroup: "chat-widget"
apiVersion: "2.0"
---

# Introduction

LiveChat Customer SDK is a set of tools utilizing the [LiveChat Customer Chat API](https://developers.livechatinc.com/docs/messaging/customer-chat-api/) that helps you build a custom chat widget. It allows you to communicate with LiveChat services directly from the browser environment using JavaScript, without the need to develop your backend.

## Is it for me?

If you need to customize the LiveChat widget, using LiveChat Customer SDK is
one of the options to do this. If you need a fully custom solution and you feel
brave, dive into LiveChat Customer SDK: we provide [methods](#methods) and
[events](#events) for deep integration with the LiveChat environment.

Keep in mind that interacting with this API requires **some development skills**. Additionally, it allows you to create front-end apps.

If you are searching for the server-side solutions, you should explore the [LiveChat Customer Chat API](https://developers.livechatinc.com/docs/messaging/customer-chat-api/) instead.

If you want to dive deeper into the LiveChat platform, you might find the [Platform Overview](https://developers.livechatinc.com/docs/getting-started/) article handy.

## About LiveChat Customer SDK

We provide an asynchronous API. Most methods return a [`Promise`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise). To the emitted events you can subscribe with `on` and `off` methods.

<div class="callout type-info">Not familiar with promises? Read <a href="https://developer.mozilla.org/pl/docs/Web/JavaScript/Reference/Global_Objects/Promise">this article</a> to learn more.</div>

We authenticate your sessions by using
[customer-auth package](https://www.npmjs.com/package/@livechat/customer-auth)
and expose the created `auth` object on the returned SDK's instance. In general,
you don't have to worry about it nor use the exposed object, but if you need to
get the authentication token you can get it through the SDK like this:

```js
customerSDK.auth.getToken().then(token => {
  console.log(token)
})
```

## Examples

We have prepared a sample chat widget implementation to present the features of LiveChat Customer SDK: [Sample widget at CodeSandbox](https://codesandbox.io/s/rm3prxw88n)

## Known issues

Currently, LiveChat Customer SDK does not support queue handling. However, it will be added soon. If you have any questions, you can start a chat with our [24/7 Support](https://direct.lc.chat/1520/125).

# How to start

This tutorial is here to help you get started with using LiveChat Customer SDK.

## Create an application

First, you need to create an application in the
[Developers Console](https://developers.livechatinc.com/console) (select the _Web app (frontend,
e.g. JavaScript)_ type).

## Install Customer SDK

You can use the LiveChat Customer SDK in two different ways:

### Using npm

`npm install --save @livechat/customer-sdk`

Now, you can import SDK in your code:

`import * as CustomerSDK from '@livechat/customer-sdk'`

or with a node-style `require` call:

`const CustomerSDK = require('@livechat/customer-sdk')`

### Using script tag - UMD module hosted on unpkg's CDN

`<script src="https://unpkg.com/@livechat/customer-sdk"></script>`

If you just want to look around and play with the SDK, check out our
[sample chat widget implementation](https://codesandbox.io/s/rm3prxw88n).

<div class="callout type-warning">For the time being you need to register your application in the <a href="https://developers.livechatinc.com/console" target="_blank">Developers Console</a>
as a "Web app (frontend, eg. JavaScript)" type. Then, you have to pass the configured <code>redirectUri</code> to the <code>init</code>, along with the regular required properties (<code>license</code> and <code>clientId</code>).</div>

## Use the API

Now run the `init` function with the configuration, replacing `LICENSE_NUMBER`
with your LiveChat license number.

It also accepts some optional arguments:

| shape       | type    | default |
| ----------- | ------- | ------- |
| autoConnect | boolean | true    |
| group       | number  |         |

The function will return the Customer SDK instance:

```js
const customerSDK = CustomerSDK.init({
  license: LICENSE_NUMBER,
  clientId: CLIENT_ID,
})
```

With `customerSDK`, you can attach [events](#events):

```js
customerSDK.on('new_event', newEvent => {
  console.log(newEvent)
})
```

or execute [methods](#methods):

```js
const chatId = 'OU0V0P0OWT'
customerSDK
  .sendEvent(chatId, {
    type: 'message',
    text: 'Hi!',
  })
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

### Using the API in React Native

If you want to use LiveChat Customer SDK in React Native, keep in mind that we
use cookies to authenticate your sessions, so we need some sort of browser
environment for that. We've prepared a special wrapper for you to use in React
Native, which opens a WebView component to get an authentication token. All you
have to do is to import it from our authentication package (no need to install
it - the SDK depends on it, so you have it already) and mount it in your React
Native application:

```js
import { AuthWebView } from '@livechat/customer-auth'
import { init } from '@livechat/customer-sdk'

export default class App extends React.Component {
  componentDidMount() {
    const customerSDK = init({
      license: LICENSE_NUMBER,
      clientId: CLIENT_ID,
      redirectUri: REDIRECT_URI,
    })
    // you can start using customerSDK from now
  }

  render() {
    return (
      <View>
        <AuthWebView />
      </View>
    )
  }
}
```

# Key Concepts

The LiveChat system includes four basic types of entities - users, chats, events and
threads.

- chats consist of threads and threads consist of events
- threads are parts of chats,
- users can add events to chats, which then are automatically added to threads
- users can participate in many chats at the same time

Threads are a vital part of the LiveChat architecture.
Grouping events in threads allows us to provide the continuous chat experience (i.e. the Customer always has the option to continue the conversation) while still maintaining smaller, logical chunks of events (e.g. for reporting and caching purposes).
Threads however tend to complicate handling of various operations like loading archival events from the chat history.
You won't have to worry about managing threads most of the time.
The Customer SDK is providing wrappers for common tasks and most methods expect to receive chat id's.
You will only get notified about thread metadata if you explicitly ask for it.

You can read more about the Key Concepts of the LiveChat Messaging in the [Messaging Overview](https://developers.livechatinc.com/docs/messaging/#key-concepts).

## User

### Agent

```js
{
  id: 'ed9d4095-45d6-428d-5093-f8ec7f1f81b9',
  type: 'agent',
  name: 'Jane Doe',
  jobTitle: 'Agent',
  avatar: 'https://cdn.livechatinc.com/cloud/?uri=https://livechat.s3.amazonaws.com/default/avatars/a7.png',
}
```

### Custoemr

```js
{
  id: 'ed9d0195-45d6-428d-5093-f8ec7f1471b9',
  type: 'customer',
  name: 'Jon Doe',
  avatar: 'https://cdn.livechatinc.com/cloud/?uri=https://livechat.s3.amazonaws.com/default/avatars/a6.png',
  fields: {
    custom_property: 'BasketValue=10usd',
  }
}
```

## Chat

```js
{
  id: 'OU0V0P0OWT',
  users: [{
    id: 'ed9d4095-45d6-428d-5093-f8ec7f1f81b9',
    // ... more user properties
  }],
  lastSeenTimestamps: {
    'ed9d4095-45d6-428d-5093-f8ec7f1f81b9': 1503062591000, // might be null
  },
  threads: ['OU0V0U3IMN'],
}
```

## Event

```js
{
  type: 'message',
  text: 'hi!',
    author: 'ed9d4095-45d6-428d-5093-f8ec7f1f81b9', // assigned by server
  id: 'OU0V0U3IMN_1', // assigned by server
    timestamp: 1503062591000, // assigned by server
    customnId: '814.3316641404942', // optional
    thread: 'OU0V4R0OXP',
  properties: {},
}
```

## Threads

```js
{
  id: 'OU0V0U3IMN',
  active: true,
  order: 3,
  users: ['ed9d4095-45d6-428d-5093-f8ec7f1f81b9'],
  lastSeenTimestamps: {
    'ed9d4095-45d6-428d-5093-f8ec7f1f81b9': 1503062591000, // might be null
  },
  events: [ /* events */ ],
}
```

# Methods

## acceptGreeting

You can use this method to inform that a Customer has seen a greeting. Based on that, the Reports section displays the greetings that were seen by Customers, not all the sent greetings. If a Customer started a chat from a greeting, but you didn't execute the accept method, the greeting counts as seen in the Reports anyway.

As arguments to this method you should use `uniqueId` & `greetingId` received in [`incoming_greeting`](#incoming_greeting) or [`connected`](#connected) event.

```js
customerSDK
  .acceptGreeting('Q10X0W041P', 7)
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   |
| ---------- | ------ |
| uniqueId   | string |
| greetingId | number |

### Errors

- `GREETING_NOT_FOUND` - given `uniqueId` could not be found on the server

## activateChat

Activates an archived chat.

```js
customerSDK
  .activateChat('OU0V0P0OWT', {
    events: [],
  })
  .then(chat => {
    console.log(chat)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters                  | type    | description                                                                                                 |
| --------------------------- | ------- | ----------------------------------------------------------------------------------------------------------- |
| chatId                      | string  |                                                                                                             |
| data.continuous             | boolean | optional                                                                                                    |
| data.chat.access            | Access  | optional                                                                                                    |
| data.chat.properties        | object  | optional                                                                                                    |
| data.chat.thread.events     | Event[] | optional, you can pass initial events here which are going to become part of the created thread immediately |
| data.chat.thread.properties | object  | optional                                                                                                    |

### Errors

- `CHAT_ALREADY_ACTIVE` - this chat is already active, and you can't activate it again.
- `GROUPS_OFFLINE` - a group in the targeted chat is offline. It can happen for licenses without continuous chats enabled.

## cancelRate

Cancels rate-related thread properties.

```js
customerSDK
  .cancelRate('ON0X0R0L67', ['score', 'comment'])
  .then(response => {
    console.log(response)
  })
  .catch(() => {
    console.log(error)
  })
```

### Errors

- `MISSING_CHAT_THREAD` - the targeted chat is empty and has no threads.

## closeThread

```js
customerSDK
  .closeThread('ON0X0R0L67')
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   | description                               |
| ---------- | ------ | ----------------------------------------- |
| chat       | string | chat id in which thread should get closed |

Returned value:

| properties | type    |
| ---------- | ------- |
| success    | boolean |

## connect

Starts connecting process to our servers. It is needed when:

- the argument `autoConnect: false` has been passed to the `init` method
- you get disconnected with a reason suspending reconnection attempts (e.g. [`inactivity_timeout`](#inactivity_timeout))

## deleteChatProperties

Deletes given properties from a chat.

```js
customerSDK
  .deleteChatProperties('ON0X0R0L67', {
    property_namespace: ['sample'],
  })
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   | description                                           |
| ---------- | ------ | ----------------------------------------------------- |
| chat       | string | id of the chat of which properties you want to delete |
| properties | object | chat properties to delete                             |

Returned value:

| properties | type    |
| ---------- | ------- |
| success    | boolean |

## deleteChatThreadProperties

Deletes given properties from a chat thread.

```js
customerSDK
  .deleteChatThreadProperties('ON0X0R0L67', 'OS0C0W0Z1B', {
    property_namespace: ['sample'],
  })
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   | description                                             |
| ---------- | ------ | ------------------------------------------------------- |
| chat       | string | id of the chat of which properties you want to delete   |
| thread     | string | id of the thread of which properties you want to delete |
| properties | object | properties to be deleted                                |

Returned value:

| properties | type    |
| ---------- | ------- |
| success    | boolean |

## deleteEventProperties

Deletes given properties from an event.

```js
customerSDK
  .deleteEventProperties('ON0X0R0L67', 'OS0C0W0Z1B', 'Q50W0A0P0Y', {
    property_namespace: ['sample'],
  })
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   | description                                             |
| ---------- | ------ | ------------------------------------------------------- |
| chat       | string | id of the chat of which properties you want to delete   |
| thread     | string | id of the thread of which properties you want to delete |
| event      | string | id of the event of which properties you want to delete  |
| properties | object | properties to be deleted                                |

Returned value:

| properties | type    |
| ---------- | ------- |
| success    | boolean |

## destroy

Clears any held resources, removes all listeners and disconnects from the network.
After using this method, you won't be able to use the destroyed SDK's instance.

```js
customerSDK.destroy()
```

## disconnect

Disconnects from the server.

```js
customerSDK.disconnect()
```

## getChatHistory

Facilitates loading more historical threads' events.
You need to get access to the `history` object for a particular chat by calling this method.
The returned `history` object has only one method, `next`, which gives you a `Promise` with a `{ done, value }` object.

- `done` - indicates if there is anything more to load
- `value` - an array of threads, each containing an array of its events

You can keep calling `history.next()` multiple times to load previous historical events, which are going to be grouped into threads and might require merging with already loaded events.
This is useful for implementing an infinite scroll or otherwise showing archival chat's to your customer.
Keep in mind, though, that you generally shouldn't call `next` while the history is loading - we queue those requests so the previous one must resolve before we proceed with the next one.

Such a structure like our `history` object is called an **async iterator**.

```js
let wholeChatHistoryLoaded = false

const history = customerSDK.getChatHistory('OU0V0P0OWT')

history.next().then(result => {
  if (result.done) {
    wholeChatHistoryLoaded = true
  }

  const threads = result.value
  const events = threads
    .map(thread => thread.events || [])
    .reduce((acc, current) => acc.concat(current), [])

  console.log(events)
})
```

Parameters:

| parameters | type   | description                          |
| ---------- | ------ | ------------------------------------ |
| chat       | string | chat id of requested history object. |

## getChatsSummary

```js
customerSDK
  .getChatsSummary({
    offset: 0,
    limit: 10,
  })
  .then(({ chatsSummary, totalChats }) => {
    console.log(chatsSummary)
    console.log(totalChats)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | properties | type   | default | max |
| ---------- | ---------- | ------ | ------- | --- |
| pagination |            |        |         |     |
|            | offset     | number | 0       |     |
|            | limit      | number | 10      | 25  |

Returned value:

| properties   | type     | properties         | type     | description                                        |
| ------------ | -------- | ------------------ | -------- | -------------------------------------------------- |
| chatsSummary | object[] |                    |          |                                                    |
|              |          | id                 |          | chat's id                                          |
|              |          | active             | boolean  |                                                    |
|              |          | users              | string[] | users' ids                                         |
|              |          | lastEvent          | object   | event                                              |
|              |          | lastEventsPerType  | object   | map from event types to event objects              |
|              |          | lastSeenTimestamps | object   | map from Users' ids to optional lastSeenTimestamps |
|              |          | lastThread         | string   | thread's id                                        |
| totalChats   | number   |                    |          |                                                    |

## getChatThreads

Returns a list of threads objects for specfied threads ids.
If you want to load more events, consider using [`getChatHistory`](#getchathistory).

```js
const threads = ["OS0C0W0Z1B", "OS0I0M0J0G", "OT01080705", "OT0E02082U", "OT0E08040G"]
customerSDK.getChatThreads("ON0X0R0L67", threads)
    .then(threads => {
        console.log(threads)
    })
    .catch(error => {
        console.log(rror
    })
```

Parameters:

| parameters | type     |
| ---------- | -------- |
| chat       | string   |
| threads    | string[] |

Returned value:

| array of shapes | type     | description                     |
| --------------- | -------- | ------------------------------- |
| id              | string   | thread id                       |
| chat            | string   | chat id                         |
| active          | string[] | active state                    |
| order           | number   | order (can be used for sorting) |
| users           | string[] | users' ids                      |
| events          | object[] | events                          |

## getChatThreadsSummary

Returns a summary of your chat threads, including the total count of threads, a list of ids and number of events in each thread.
If you want to load more threads summary consider using [`getChatHistory`](#getchathistory).

```js
customerSDK
  .getChatThreadsSummary('ON0X0R0L67', {
    offset: 0,
    limit: 10,
  })
  .then(summary => {
    console.log(summary.threadsSummary)
    console.log(summary.totalThreads)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | properties | type   | default | max  |
| ---------- | ---------- | ------ | ------- | ---- |
| chat       |            | string |         |      |
| pagination |            |        |         |      |
|            | offset     | number | 0       |      |
|            | limit      | number | 25      | 1000 |

Returned value:

| properties     | type     | properties  | type   |
| -------------- | -------- | ----------- | ------ |
| threadsSummary | object[] |             |        |
|                |          | id          | string |
|                |          | order       | number |
|                |          | totalEvents | number |
| totalThreads   | number   |             |        |

## getCustomer

Returns the info about the Customer requesting it.

```js
customerSDK
  .getCustomer()
  .then(customer => {
    console.log(customer)
  })
  .catch(error => {
    console.log(error)
  })
```

Returned value:

| properties | type       | description          |
| ---------- | ---------- | -------------------- |
| type       | 'customer' |                      |
| id         | string     |                      |
| name       | string     | returned only if set |
| email      | string     | returned only if set |
| avatar     | string     | returned only if set |
| fields     | object     | returned only if set |

## getForm

Allows you to fetch a form template for a given group and form type.

```js
customerSDK
  .getForm(0, 'prechat')
  .then(response => {
    if (response.enabled) {
      // prechat form is enabled for this group in the configurator
      console.log(response.form)
    }
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type                              |
| ---------- | --------------------------------- |
| group      | number                            |
| type       | 'prechat', 'postchat' or 'ticket' |

Returned value:

| properties  | type     | description                                 |
| ----------- | -------- | ------------------------------------------- |
| enabled     | boolean  |                                             |
| form        | object   | available only when a given form is enabled |
| form.id     | string   |                                             |
| form.fields | object[] |                                             |

## getGroupsStatus

Returns availability statuses of the requested groups.

```js
customerSDK
  .getGroupsStatus([3, 10])
  .then(statusMap => {
    console.log(`Status of the group 3: ${statusMap[3]}`)
    console.log(`Status of the group 10: ${statusMap[10]}`)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type     | description                                              |
| ---------- | -------- | -------------------------------------------------------- |
| groups     | number[] | optional, if omitted statuses of all groups are returned |

Returned value:

| properties | type   | description                                     |
| ---------- | ------ | ----------------------------------------------- |
| statusMap  | object | a map of group numbers to availability statuses |

## getPredictedAgent

```js
customerSDK
  .getPredictedAgent(0)
  .then(agent => {
    console.log(agent)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   | description |
| ---------- | ------ | ----------- |
| group      | number | optional    |

### Errors

- `GROUP_OFFLINE` - the requested group is offline, and it was not possible to return a predicted agent for it.
- `GROUP_UNAVAILABLE` - there are no available slots in the requested group, so it is not possible to return a predicted agent for it. If you call `startChat` or `activateChat` appropriately, you are most likely to end up in the queue.

## getUrlDetails

It returns the info on a given URL.

```js
customerSDK
  .getUrlDetails('https://www.livechatinc.com')
  .then(urlDetails => {
    if (urlDetails.title) {
      console.log(`The title of requested URL is: ${urlDetails.title}`)
    }
    if (urlDetails.description) {
      console.log(
        `The description of requested URL is: ${urlDetails.description}`,
      )
    }
    if (urlDetails.image) {
      console.log(
        `The preview image of requested URL is available under: ${urlDetails.image.url}`,
      )
      console.log(`Its width is: ${urlDetails.image.width}`)
      console.log(`Its height is: ${urlDetails.image.height}`)
    }
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   |
| ---------- | ------ |
| url        | string |

Returned value:

| properties   | type   | description |
| ------------ | ------ | ----------- |
| url          | string |             |
| title        | string | optional    |
| description  | string | optional    |
| image        | object | optional    |
| image.url    | string |             |
| image.width  | number |             |
| image.height | number |             |

## off

Unsubscribes from emitted events which are described [here](#events).

## on

Subscribes to emitted events which are described [here](#events).

## once

Subscribes to emitted events which are described [here](#events) and unsubscribes immediately after the callback gets called.

## markEventsAsSeen

Marks events, as seen by the current customer up to the given date.

```js
customerSDK
  .markEventsAsSeen('ON0X0R0L67', '2017-10-12T15:19:21.010200Z')
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   | description                                                                              |
| ---------- | ------ | ---------------------------------------------------------------------------------------- |
| chat       | string | id of the chat in which you want to mark events as seen                                  |
| seenUpTo   | string | RFC 3339 date-time format, you should use the event's `createdAt` value as this argument |

Returned value:

| properties | type    |
| ---------- | ------- |
| success    | boolean |

## rateChat

Sends a chat rating and comment for the most recent chat thread.

```js
customerSDK
  .rateChat('ON0X0R0L67', {
    score: 1,
    comment: 'Agent helped me a lot!',
  })
  .then(() => {
    console.log('Rating has been set')
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters     | type   | description                                               |
| -------------- | ------ | --------------------------------------------------------- |
| chat           |        | destination chat id                                       |
| rating         |        |                                                           |
| rating.score   | 0 or 1 | rating value - 0 for a bad rating and 1 for a good rating |
| rating.comment | string | optional comment                                          |

Returned value:

| type    | description                                     |
| ------- | ----------------------------------------------- |
| promise | promise resolving with a constant success value |

### Errors

- `MISSING_CHAT_THREAD` - the targeted chat cannot be rated because it has no threads.

## rejectGreeting

Rejects a greeting (an invitation to the chat). For example, Customers could reject greetings by clicking the close icon on the displayed greeting.

```js
customerSDK
  .rejectGreeting('Q10X0W041P')
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   |
| ---------- | ------ |
| uniqueId   | string |

### Errors

- `GREETING_NOT_FOUND` - given `uniqueId` could not be found on the server

## sendEvent

Sends an provided object as a event with specified type.

```js
const event = {
  type: 'message',
  // ... other properties specific for the event's type
}

customerSDK
  .sendEvent('ON0X0R0L67', event)
  .then(event => {
    console.log(event)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters              | type    | description         |
| ----------------------- | ------- | ------------------- |
| chat                    | string  | destination chat id |
| event                   |         |                     |
| event.type              | string  | type of the event   |
| meta                    |         | optional            |
| meta.attachToLastThread | boolean | optional            |

## sendPostback

Sends infomration to the server about user interaction with rich message button.

```js
customerSDK
  .sendPostback('ON0X0R0L67', 'OS0C0W0Z1B', 'OS0C0W0Z1B01', {
    id: 'OS0C0W0Z1B01002',
    toggled: true,
  })
  .then(rating => {
    console.log('success')
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters       | type    | default | description        |
| ---------------- | ------- | ------- | ------------------ |
| chat             | string  |         | postback chat id   |
| thread           | string  |         | postback thread id |
| event            | string  |         | postback event id  |
| postback         |         |         |                    |
| postback.id      | string  |         | postback button id |
| postback.toggled | boolean | true    | postback toggled   |

## sendTicketForm

Can be used to send a filled ticket form.

```js
customerSDK
  .sendTicketForm(
    {
      type: 'filled_form',
      formId: '',
      fields: [
        {
          type: 'subject',
          id: '0',
          label: 'Subject:',
          answer: 'Order number 123',
        },
        {
          type: 'email',
          id: '1',
          label: 'Your email:',
          answer: 'john.doe@example.com',
        },
        {
          type: 'checkbox',
          id: '2',
          label: 'Question:',
          answers: [
            { id: '0', label: 'First answer' },
            { id: '1', label: 'Second answer' },
          ],
        },
        {
          type: 'textarea',
          id: '3',
          label: 'Your message:',
          answer:
            'Could I get a status update on this order? Have you already shipped it?',
        },
      ],
    },
    10,
  )
  .then(response => {
    console.log(`Created a ticket with id: ${response.id}`)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters        | type              | description |
| ----------------- | ----------------- | ----------- |
| filledForm.type   | 'filled_form'     |             |
| filledForm.formId | string            |             |
| filledForm.fields | FilledFormField[] |             |
| group             | number            | optional    |

Returned value:

| properties | type   | description              |
| ---------- | ------ | ------------------------ |
| id         | string | id of the created ticket |

## setCustomerFields

Sends the request if the SDK is connected or queues the update to perform once the connection gets established.

```js
customerSDK.setCustomerFields({
  foo: 'bar',
  test: 'qwerty',
})
```

Parameters:

| parameters | type   |
| ---------- | ------ |
| fields     | object |

## setSneakPeek

Doesn't return a promise.
You can use it to update the [sneak peek](https://www.livechatinc.com/blog/customer-message-sneak-peak/) in the agent application.
It is sent to the server only if the target chat is active and only once per 2 seconds (it's [throttled](https://lodash.com/docs/4.17.4#throttle)).

```js
customerSDK.setSneakPeek('ON0X0R0L67', 'what is the price for your ')
```

Parameters:

| parameters | type   | description                              |
| ---------- | ------ | ---------------------------------------- |
| chat       | string | destination chat id                      |
| text       | string | message preview broadcasted to the agent |

## startChat

Starts a new chat. For one customer you can only start one chat.
In order to activate previously started chat use [`activateChat`](#activateChat).

```js
customerSDK
  .startChat({
    events: [],
  })
  .then(chat => {
    console.log(chat)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters             | type    | description                                                                               |
| ---------------------- | ------- | ----------------------------------------------------------------------------------------- |
| continuous             | boolean | optional                                                                                  |
| chat.access            | access  | optional                                                                                  |
| chat.properties        | object  | optional                                                                                  |
| chat.thread.events     | event[] | optional, initial events which are going to become part of the created thread immediately |
| chat.thread.properties | object  | optional                                                                                  |

### Errors

- `CHAT_LIMIT_REACHED` - the maximum limit of chats per customer has been reached, and it's not possible to start a new one. You should activate one of the existing ones. The limit is 1.
- `GROUPS_OFFLINE` - a group in the targeted chat is offline. It can happen for licenses that don't allow customers to chat during their unavailability.

## updateChatProperties

```js
const properties = {
  property_namespace: {
    sample: 'property',
  },
}
customerSDK
  .updateChatProperties('ON0X0R0L67', properties)
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   | description                                           |
| ---------- | ------ | ----------------------------------------------------- |
| chat       | string | id of the chat of which properties you want to update |
| properties | object |

## updateChatThreadProperties

```js
const properties = {
  property_namespace: {
    sample: 'property',
  },
}
customerSDK
  .updateChatThreadProperties('ON0X0R0L67', 'OS0C0W0Z1B', properties)
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   | description                                             |
| ---------- | ------ | ------------------------------------------------------- |
| chat       | string | id of the chat of which properties you want to update   |
| thread     | string | id of the thread of which properties you want to update |
| properties | object |

## updateCustomer

Updates secified customer properties and fields.

```js
const properties = {
  name: 'John Doe',
  email: 'john.doe@example.com',
  fields: {
    custom_property: 'BasketValue=10usd',
    any_key_is_ok: 'sample custom field',
  },
}
customerSDK.updateCustomer(properties)
```

Parameters:

| parameters        | type   | description                                |
| ----------------- | ------ | ------------------------------------------ |
| properties        |        |                                            |
| properties.name   | string | optional                                   |
| properties.email  | string | optional                                   |
| properties.fields | object | optional, custom fields with string values |

## updateCustomerPage

Updates information about the customer page using provided page object.

```js
const page = {
  url: 'https://developers.livechatinc.com/',
  title: 'LiveChat for Developers',
}
customerSDK.updateCustomerPage(page)
```

Parameters:

| parameters | type   |
| ---------- | ------ |
| page       |        |
| page.url   | string |
| page.title | string |

## updateEventProperties

Updates given properties on an event.

```js
const properties = {
  property_namespace: {
    sample: 'property',
  },
}
customerSDK
  .updateEventProperties('ON0X0R0L67', 'OS0C0W0Z1B', 'Q50W0A0P0Y', properties)
  .then(response => {
    console.log(response)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters | type   | description                                             |
| ---------- | ------ | ------------------------------------------------------- |
| chat       | string | id of the chat of which properties you want to update   |
| thread     | string | id of the thread of which properties you want to update |
| event      | string | id of the event of which properties you want to update  |
| properties | object |                                                         |

## uploadFile

Returns both a `promise` and a `cancel`. You can use `cancel` to abort the upload of the file.
It also lets you pass `onProgress` callback function. Keep in mind that the maximum accepted file size is 10 MB.

```js
const { promise, cancel } = customerSDK.uploadFile(
  'ON0X0R0L67',
  {
    file,
    customId, // optional
  },
  {
    onProgress: progress => console.log(`upload progress: ${progress}`),
  },
)

document.getElementById('cancel-upload').onclick = () => {
  cancel()
}

promise
  .then(response => {
    console.log(response.url)
  })
  .catch(error => {
    console.log(error)
  })
```

Parameters:

| parameters      | type     | description                                                                   |
| --------------- | -------- | ----------------------------------------------------------------------------- |
| chat            | string   | destination chat id                                                           |
| data            |          |                                                                               |
| data.file       | blob     |                                                                               |
| data.customId   | string   | optional customId for the event                                               |
| spec            |          |                                                                               |
| spec.onProgress | function | this callback function will receive a progress value - number between 0 and 1 |

Returned value:

| properties | type   |
| ---------- | ------ |
| url        | string |

In React Native instead of passing a blob, you need to pass an object of
[such shape](https://github.com/facebook/react-native/blob/56fef9b6225ffc1ba87f784660eebe842866c57d/Libraries/Network/FormData.js#L34-L38):

```js
const file = {
  uri: uriFromCameraRoll,
  type: 'image/jpeg', // optional
  name: 'photo.jpg', // optional
}
```

# Events

You can listen for emitted events by subscribing to them using the [on](#on) method with your custom callback.
For example, your function can be executed every time a message is received.

## Access set

Informs that new, single access to a resource was set. The existing access is overwritten.

```js
customerSDK.on('access_set', ({ resource, id, access }) => {
  console.log('access_set', { resource, id, access })
})
```

Payload:

| properties | type   |
| ---------- | ------ |
| resource   | string |
| id         | string |
| access     | object |

## Availability updated

Informs about changed availability status.

```js
customerSDK.on('availability_updated', ({ availability }) => {
  console.log('availability_updated', availability)
})
```

Payload:

| properties   | type   | description           |
| ------------ | ------ | --------------------- |
| availability | string | 'online' or 'offline' |

## Chat properties deleted

Informs about deleted chat properties.

```js
customerSDK.on('chat_properties_deleted', payload => {
  const { chat, properties } = payload
  console.log('chat_thread_properties_deleted', { chat, properties })
})
```

Payload:

| properties | type   | description     |
| ---------- | ------ | --------------- |
| chat       | string | chat id         |
| properties | object | chat properties |

## Chat properties updated

Informs about updated chat properties.

```js
customerSDK.on('chat_properties_updated', payload => {
  const { chat, properties } = payload
  console.log('chat_properties_updated', payload)
})
```

Payload:

| properties | type   | description     |
| ---------- | ------ | --------------- |
| chat       | string | chat id         |
| properties | object | chat properties |

## Chat thread properties deleted

Informs about deleted thread properties.

```js
customerSDK.on('chat_thread_properties_deleted', payload => {
  const { chat, thread, properties } = payload
  console.log('chat_thread_properties_deleted', { chat, thread, properties })
})
```

Payload:

| properties | type   | description            |
| ---------- | ------ | ---------------------- |
| chat       | string | chat id                |
| thread     | string | thread id              |
| properties | object | chat thread properties |

## Chat thread properties updated

```js
customerSDK.on('chat_thread_properties_updated', payload => {
  const { chat, thread, properties } = payload
  console.log('chat_thread_properties_updated', { chat, thread, properties })
})
```

Payload:

| properties | type   | description       |
| ---------- | ------ | ----------------- |
| chat       | string | chats id          |
| thread     | string | thread id         |
| properties | object | thread properties |

## Chat transferred

Informs that a chat was transferred to a different group or an agent.

```js
customerSDK.on('chat_transferred', payload => {
  const { chatId, threadId, requesterId, type, ids } = payload
  console.log('chat_transferred', { chatId, threadId, requesterId, type, ids })
})
```

Payload:

| properties  | type               |
| ----------- | ------------------ |
| chatId      | string             |
| threadId    | string             |
| requesterId | string             |
| type        | 'agent' \| 'group' |
| ids         | string[]           |

## Chat user added

Informs that a user was added to a chat.

```js
customerSDK.on('chat_user_added', payload => {
  const { user, chat, present } = payload
  console.log('chat_user_added', { user, chat, present })
})
```

Payload:

| properties | type    | description |
| ---------- | ------- | ----------- |
| user       | object  | user        |
| chat       | string  | chat id     |
| present    | boolean |             |

## Chat user removed

Informs that a user was removed from a chat.

```js
customerSDK.on('chat_user_removed', payload => {
  const { userId, chat } = payload
  console.log('chat_user_removed', { userId, chat })
})
```

Payload:

| properties | type   | description |
| ---------- | ------ | ----------- |
| userId     | string | user id     |
| chat       | string | chat id     |

## Connected

```js
customerSDK.on('connected', payload => {
  const { availability, greeting } = payload
  console.log('connected', { availability, greeting })
})
```

Payload:

| argument     | type     | description                                        |
| ------------ | -------- | -------------------------------------------------- |
| availability | string   | 'online' or 'offline'                              |
| greeting?    | greeting | optional greeting received before the chat started |

Greeting:

| argument           | type    | description                          |
| ------------------ | ------- | ------------------------------------ |
| id                 | number  | greeting template identifier         |
| text               | string  | text content of the greeting message |
| uniqueId           | string  | event uniqueId for the greeting      |
| displayedFirstTime | boolean |                                      |
| accepted           | boolean |                                      |
| agent.id           | string  |                                      |
| agent.name         | string  |                                      |
| agent.avatar       | string  |                                      |
| agent.jobTitle     | string  |                                      |
| agent.isBot        | boolean |                                      |

## Connection lost

```js
customerSDK.on('connection_lost', () => {
  console.log('connection_lost')
})
```

This event doesn't carry any additional payload.

## Connection recovered

It informs that Customer SDK has recovered from an "unstable" connection state. It's always preceded by the [`"connection_unstable"`](#connection-unstable) event.

```js
customerSDK.on('connection_recovered', () => {
  console.log('connection_recovered')
})
```

This event doesn't carry any additional payload.

## Connection unstable

It informs that Customer SDK has detected that connection quality is poor. It doesn't mean that it has disconnected from the server just yet.

```js
customerSDK.on('connection_unstable', () => {
  console.log('connection_unstable')
})
```

This event doesn't carry any additional payload.

## Customer id

```js
customerSDK.on('customer_id', id => {
  console.log('customer id is', id)
})
```

Payload:

| argument | type   |
| -------- | ------ |
| id       | string |

## Customer page updated

The Customer moved to another page, for example by following a link on your website.

```js
customerSDK.on('customer_page_updated', payload => {
  const { url, title, timestamp } = payload
  console.log('customer_page_updated', ({ url, title, timestamp })
})
```

Payload:

| properties | type   |                                                      |
| ---------- | ------ | ---------------------------------------------------- |
| url        | string | URL on which the Customer currently is.              |
| title      | string | title of the website on which Customer currently is. |
| timestamp  | string | timestamp of the latest change.                      |

## Customer updated

Informs that Customer's data was updated.
Each property in payload is available only if it was updated.

```js
customerSDK.on('customer_updated', payload => {
  if (payload.name) {
    console.log(`Name got updated to: ${payload.name}`)
  }
  if (payload.email) {
    console.log(`Email got updated to: ${payload.email}`)
  }
  if (payload.avatar) {
    console.log(`Avatar got updated to: ${payload.avatar}`)
  }
  if (payload.fields) {
    console.log(`Fields got updated:`)
    console.log(payload.fields)
  }
})
```

Payload:

| properties | type   |
| ---------- | ------ |
| name       | string |
| email      | string |
| avatar     | string |
| fields     | object |

## Disconnected

Informs that SDK has disconnected from the server and provides reason.

```js
customerSDK.on('disconnected', payload => {
  const { reason } = payload
  console.log('disconnected', { reason })
})
```

Payload:

| properties | type   | description                                |
| ---------- | ------ | ------------------------------------------ |
| reason     | string | [#disconnection-reasons](possible reasons) |

## Event properties deleted

Informs about those event properties that were deleted.

```js
customerSDK.on('event_properties_deleted', payload => {
  const { chat, thread, event, properties } = payload
  console.log('event_properties_deleted', { chat, thread, event, properties })
})
```

Payload:

| properties | type   | description      |
| ---------- | ------ | ---------------- |
| chat       | string | chat id          |
| thread     | string | thread id        |
| event      | string | event id         |
| properties | object | event properties |

## Event properties updated

Informs about those event properties that were updated.

```js
customerSDK.on('event_properties_updated', payload => {
  const { chat, thread, event, properties } = payload
  console.log('event_properties_updated', { chat, thread, event, properties })
})
```

Payload:

| properties | type   | description      |
| ---------- | ------ | ---------------- |
| chat       | string | chat id          |
| thread     | string | thread id        |
| event      | string | event id         |
| properties | object | event properties |

## Event updated

Informs that an event was updated.

```js
customerSDK.on('event_updated', payload => {
  const { chat, thread, event } = payload
  console.log('event_updated', { chat, thread, event })
})
```

Payload:

| properties | type   | description         |
| ---------- | ------ | ------------------- |
| chat       | string | chat id             |
| thread     | string | thread id           |
| event      | object | whole updated event |

## Events marked as seen

```js
customerSDK.on('events_marked_as_seen', payload => {
  const { chat, user, timetamp } = payload
  console.log('events_marked_as_seen', { chat, user, timetamp })
})
```

Payload:

| properties | type   | description |
| ---------- | ------ | ----------- |
| chat       | string | chat id     |
| user       | string | user id     |
| timestamp  | number |             |

## Incoming chat thread

Informs about a newly started chat thread.
The payload contains the chat data structure and an object describing the new thread.
If the chat was started with some initial events, they will be included in the thread object.

```js
customerSDK.on('incoming_chat_thread', payload => {
  const { chat } = payload
  const { id, access, users, properties, thread } = chat
  console.log('incoming_chat_thread', { id, access, users, properties, thread })
})
```

Payload:

| properties      | type     | description                          |
| --------------- | -------- | ------------------------------------ |
| chat.id         | string   | chat id                              |
| chat.access     | object   | chat initial access                  |
| chat.users      | object[] | users objects referenced in the chat |
| chat.properties | object   | chat properties                      |
| chat.thread     | object   |                                      |

## Incoming event

Informs about an incoming event sent to a chat.
You should distinguish received events by their types.

```js
customerSDK.on('incoming_event', payload => {
  const { chat, event } = payload
  switch (event.type) {
    case 'message':
      console.log('new message - ', event.text)
      break
    default:
      break
  }
})
```

Payload:

| properties | type   | description      |
| ---------- | ------ | ---------------- |
| type       | string | event type       |
| ...        |        | other properties |

## Incoming greeting

Informs about an incoming greeting.

```js
customerSDK.on('incoming_greeting', payload => {
  const { text, agent } = payload
  const { name } = agent
  console.log(`Received a greeting with "${text}" text content from ${name}.`)
})
```

Payload:

| properties         | type    | description                                                 |
| ------------------ | ------- | ----------------------------------------------------------- |
| id                 | number  | greeting template id                                        |
| text               | string  | greeting text content                                       |
| uniqueId           | string  | greeting unique id                                          |
| displayedFirstTime | boolean | describes if the greeting was generated for the first time. |
| accepted           | boolean | chat properties                                             |
| agent              | object  | agent user                                                  |

## Incoming rich message postback

Informs about an incoming greeting.

```js
customerSDK.on('incoming_rich_message_postback', payload => {
  const { user, chat, thread, event, postback } = payload
  console.log('incoming_rich_message_postback', payload)
})
```

Payload:

| properties       | type    | description                                |
| ---------------- | ------- | ------------------------------------------ |
| user             | number  | user who has sent a rich message postback  |
| chat             | string  | chat id of the sent postback               |
| thread           | string  | thread id of the sent postback             |
| event            | string  | event id of the sent postback              |
| postback.id      | boolean | id of the sent postback                    |
| postback.toggled | boolean | describes if the sent postback was toggled |

## Incoming typing indicator

Informs that one of the chat users is currently typing a message.
The message hasn't been sent yet.
The push payload contains the typing indicator object.

```js
customerSDK.on('incoming_typing_indicator', payload => {
  if (payload.isTyping) {
    console.log(
      `user with ${payload.user} id is writing something in ${payload.chat}`,
    )
  } else {
    console.log(
      `user with ${payload.user} id stopped writing in ${payload.chat}`,
    )
  }
})
```

Payload:

| properties | type    | description |
| ---------- | ------- | ----------- |
| chat       | string  | chat id     |
| user       | string  | user id     |
| isTyping   | boolean |             |

## Thread closed

```js
customerSDK.on('thread_closed', payload => {
  const { chat } = payload
  console.log('thread_closed', { chat })
})
```

Payload:

| properties | type   | description |
| ---------- | ------ | ----------- |
| chat       | string | chat id     |

## User data

```js
customerSDK.on('user_data', user => {
  console.log(user)
})
```

Customer user:

| properties | type           | description |
| ---------- | -------------- | ----------- |
| type       | 'customer'     |             |
| id         | string         |             |
| name       | string         | optional    |
| email      | string         | optional    |
| avatar     | string         | optional    |
| fields     | customerFields |             |

Agent user:

| properties | type    |
| ---------- | ------- |
| type       | 'agent' |
| id         | string  |
| name       | string  |
| avatar     | string  |
| jobTitle   | string  |

Disconnection reasons and errors

# Disconnection reasons

Most of the disconnection reasons can be treated as errors, and because of that they are described in more detail in this section.

```js
customerSDK.on('disconnected', ({ reason }) => {
  switch (reason) {
    case 'access_token_expired':
      // handle particular disconnection reasons
      break
    // ...
    default:
  }
})
```

## Access token expired

Access token lifetime has elapsed. Customer SDK fetches a new token and reconnects to the server on its own. This is emitted to the user for informational purposes, so, for example, a reconnection bar can be displayed.

## Customer banned

The Customer has been banned.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

## Customer temporarily blocked

The Customer tried reconnecting too many times after the [`"too_many_connections"`](#too-many-connections) error had occurred.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

## Identity mismatch

The identity of the customer has changed between reconnects. This might happen if cookies can't be persisted in the browser.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

## Inactivity timeout

The Customer didn't chat or change the page in the past 30 minutes. Customer SDK **won't** try to reconnect on its own after receiving this. You should implement a reconnect login on your own. Preferably you should only try to connect again when you detect a clear intention of chatting from your user.

## Internal error

Internal error. Customer SDK reconnects on its own.

## License not found

The license with the specified id doesn't exist. You should check the options passed to the Customer SDK and make sure that the license parameter is correct.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

## Misdirected connection

You have connected to a server in the wrong region. Customer SDK reconnects to the correct region on its own, but to avoid this problem altogether, you should provide the correct `region` parameter when initializing the SDK. This is emitted to the user for informational purposes, so, for example, a reconnection bar can be displayed.

## Too many connections

The Customer has reached the maximum number of connections. You should avoid opening too many concurrent connections for the same customer.

This internally destroys the current instance of Customer SDK, so it won't be possible to reuse it.

## Too many unauthorized connections

The maximum number of unauthorized connections has been reached. This error can only be received immediately after you try to connect to our servers when there are too many pending (unauthorized) connections. Once you get authorized, you stay that way and the Customer SDK reconnects on its own.

## Unsupported version

Connecting to an unsupported version of the Customer Chat API. You should upgrade your Customer SDK version.

This internally destroys the current instance of the Customer SDK, so it won't be possible to reuse it.

## Users limit reached

The maximum number of concurrently connected customers has been reached. This can only be received immediately after we try to connect to our servers because once you get authorized, you stay that way. The limit is different for each plan, and you can check the exact values on our [pricing page](https://www.livechatinc.com/pricing/).

This internally destroys the current instance of the Customer SDK, so it won't be possible to reuse it.

# Errors

This is the list of standard error codes. You can receive them for all available methods which perform API calls. This means that those can happen for methods returning Promises and because we wrap API calls with Promise interface, those are available on thrown `Error` objects under the `code` property. They can be caught using a regular Promise `catch` method.

There are also some per-method error codes which are not described below, but instead, they are mentioned under corresponding methods.

## Connection lost

All in-flight requests fail with this one when the network connection gets lost.

## Customer banned

The Customer has been banned.

## Group not found

Can be received in response to any request which accepts a group somewhere in its payload.

## Internal

Internal error.

## Pending requests limit reached

This is a rate-limiting error.
You have sent out too many requests in a too short time period, without waiting for them to resolve.

## Request timeout

The request has timed out.

## Validation

Wrong format of request, for example, a `string` sent in the place of a `number`.

# Changelog

#### [v2.0.0-alpha.0] - 2018-08-17

Initial alpha release.
